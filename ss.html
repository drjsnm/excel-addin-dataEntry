<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Data Entry Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #40e0d0;
      padding: 20px;
    }
    .container {
      display: flex;
    }
    .form-container {
      flex: 1;
      background: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0px 0px 5px 0px #888;
    }
    h2 {
      text-align: center;
      color: #333;
      font-size: 30px;
    }
    form {
      padding: 10px;
    }
    label {
      font-weight: bold;
    }
    input[type="text"],
    input[type="date"] {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border: 1px solid #ccc;
      border-radius: 3px;
    }
    textarea {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border: 1px solid #ccc;
      border-radius: 3px;
    }
    input[type="button"] {
      background-color: #007bff;
      color: #fff;
      border: none;
      padding: 10px 20px;
      margin-top: 10px;
      border-radius: 3px;
      cursor: pointer;
    }
    input[type="button"]:hover {
      background-color: #0056b3;
    }
    .image-container {
      flex: 1;
      text-align: center;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .image-container img {
      max-width: 100%;
      max-height: auto;
      border-radius: 50%;
    }
    .vision-text {
      font-weight: bold;
      text-align: center;
      color: #333;
      font-size: 20px; 
    }
    #copyright {
      text-align: center;
      font-style: italic;
      position: absolute;
      bottom: -200px;
      right: 10px;
    }
  </style>
</head>
<body>
  <h2>Data Entry Form</h2>
  <div class="container">
    <div class="form-container">
      <form id="data-entry-form">
        <label for="department">Department:</label>
        <input type="text" id="department" name="department" required><br><br>

        <label for="activities">Activities/Objectives:</label>
        <textarea id="activities" name="activities" rows="4" required></textarea><br><br>

        <label for "target">Target:</label>
        <input type="text" id="target" name="target" required><br><br>

        <label for="achievement">Achievement:</label>
        <input type="text" id="achievement" name="achievement" required><br><br>

        <label for="deadline">Deadline:</label>
        <input type="date" id="deadline" name="deadline" required><br><br>

        <label for="submitted-on">Submitted on:</label>
        <input type="date" id="submitted-on" name="submitted-on" required><br><br>

        <label for="remarks">Remarks:</label>
        <textarea id="remarks" name="remarks" rows="4"></textarea><br><br>

        <input type="button" value="Add Record" onclick="addRecord()">
        <input type="button" value="Search" onclick="searchRecords()">
        <input type="button" value="Delete" onclick="deleteRecord()">
        <input type="button" value="Update" onclick="updateRecord()">
        <input type="button" value="Exit" onclick="exitForm()">
      </form>
    </div>

    <div class="image-container">
      <img src="Images/imgnppf.jpg" alt="Image">
      <p class="vision-text" style="font-size: 24px;">OUR VISION</p>
      <p class="vision-text">A premier organization which secures the retirement lives of members through effective income security</p>
    </div>

    <div id="copyright">
      <p>&copy; 2023 SONAM.D</p>
    </div>
  </div>
</body>
</html>

<script>
  // Function to add a new record to the Excel sheet
// Function to add a new record to the Excel sheet
function addRecord() {
  Excel.run(function(context) {
    var sheet = context.workbook.worksheets.getActiveWorksheet();
    var values = [
      [
        document.getElementById("department").value,
        document.getElementById("activities").value,
        document.getElementById("target").value,
        document.getElementById("achievement").value,
        document.getElementById("deadline").value,
        document.getElementById("submitted-on").value,
        document.getElementById("remarks").value,
      ]
    ];
    // Dynamically determine the range based on the existing data in column A
    var rowCount = sheet.getRange("A1:A100").getUsedRangeOrNullObject().load("rowCount");
    return context.sync().then(function () {
      if (rowCount.rowCount > 0) {
        var newRange = sheet.getRangeByIndexes(rowCount.rowCount, 0, 1, 7);
        newRange.values = values;
      } else {
        // If the column is empty, start at A2
        var newRange = sheet.getRange("A2:H2");
        newRange.values = values;
      }
      return context.sync();
    }).catch(function(error) {
      console.log("Error adding record: " + error);
    });
  }).catch(function(error) {
    console.log("Error adding record: " + error);
  });
}

// Function to search for a department and display details
function searchRecords() {
  Excel.run(function(context) {
    var sheet = context.workbook.worksheets.getActiveWorksheet();
    var searchValue = document.getElementById("department").value;
    var range = sheet.getRange("A2:A100"); // Dynamically determine the range based on the existing data
    range.load("values");
    return context.sync()
      .then(function() {
        var found = false;
        for (var i = 0; i < range.values[0].length; i++) {
          if (range.values[0][i] === searchValue) {
            // Display details or do something with the found data
            found = true;
            // Implement code to display or process the found data
            break;
          }
        }
        if (!found) {
          console.log("Department not found. If you wish to add the department/Division/Unit, click on 'Add' option below.");
        }
      }).catch(function(error) {
        console.log("Error searching records: " + error);
      });
  }).catch(function(error) {
    console.log("Error searching records: " + error);
  });
}

// Function to delete a record or row with a confirmation prompt for options
function deleteRecord() {
  if (confirm("Do you wish to delete this record or the whole row?\n\nClick OK to delete the record or Cancel to delete the whole row.")) {
    var deleteOption = prompt("Enter 'record' to delete the record or 'row' to delete the whole row:", "record");

    if (deleteOption) {
      deleteOption = deleteOption.trim().toLowerCase();
      if (deleteOption === "record" || deleteOption === "row") {
        // Implement code to delete the record or row in the Excel sheet
        Excel.run(function(context) {
          var sheet = context.workbook.worksheets.getActiveWorksheet();
          var searchValue = document.getElementById("department").value;
          var range = sheet.getRange("A2:A100"); // Dynamically determine the range based on the existing data
          range.load("values");
          return context.sync()
            .then(function() {
              var rowIndex = -1;
              for (var i = 0; i < range.values[0].length; i++) {
                if (range.values[0][i] === searchValue) {
                  rowIndex = i;
                  break;
                }
              }
              if (rowIndex >= 0) {
                if (deleteOption === "record") {
                  // Implement code to delete the record
                  sheet.getRangeByIndexes(rowIndex, 0, 1, 7).clear(Excel.ClearApplyTo.contents);
                } else if (deleteOption === "row") {
                  // Implement code to delete the entire row
                  sheet.getRangeByIndexes(rowIndex, 0, 1, 7).getEntireRow().delete(Excel.DeleteShiftDirection.up);
                }
                return context.sync();
              } else {
                console.log("Department not found. Unable to delete the " + deleteOption + ".");
              }
            }).catch(function(error) {
              console.log("Error deleting record/row: " + error);
            });
        }).catch(function(error) {
          console.log("Error deleting record/row: " + error);
        });
      } else {
        console.log("Invalid option. Please enter 'record' or 'row'.");
      }
    } else {
      console.log("No option provided. Operation canceled.");
    }
  }
}

// Function to update a record with a confirmation prompt
function updateRecord() {
  if (confirm("Do you wish to update this record?")) {
    var searchValue = document.getElementById("department").value; // The value to search for
    var updatedActivities = document.getElementById("activities").value;
    var updatedTarget = document.getElementById("target").value;
    var updatedAchievement = document.getElementById("achievement").value;
    var updatedDeadline = document.getElementById("deadline").value;
    var updatedSubmittedOn = document.getElementById("submitted-on").value;
    var updatedRemarks = document.getElementById("remarks").value;

    Excel.run(function(context) {
      var sheet = context.workbook.worksheets.getActiveWorksheet();
      var range = sheet.getRange("A2:A100"); // Dynamically determine the range based on the existing data
      range.load("values");
      return context.sync()
        .then(function()
        {
          var rowIndex = -1;
          for (var i = 0; i < range.values[0].length; i++) {
            if (range.values[0][i] === searchValue) {
              rowIndex = i;
              break;
            }
          }
          if (rowIndex >= 0) {
            // Update the record in the Excel sheet
            var updateRange = sheet.getRangeByIndexes(rowIndex, 1, 1, 6);
            updateRange.values = [[
              updatedActivities,
              updatedTarget,
              updatedAchievement,
              updatedDeadline,
              updatedSubmittedOn,
              updatedRemarks
            ]];
            return context.sync();
          } else {
            console.log("Department not found. Unable to update the record.");
          }
        });
    }).catch(function(error) {
      console.log("Error updating record: " + error);
    });
  }
}

// Function to exit the add-in form
function exitForm() {
  Excel.run(function(context) {
    var taskpane = OfficeExtension.ExtensionHelpers.getTaskpane();
    taskpane.close();
    return context.sync();
  }).catch(function(error) {
    console.log("Error exiting form: " + error);
  });
}
</script>
